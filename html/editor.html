<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.R.V.I.S. Code Editor - Stark Industries</title>
    <!-- Access Control - Must load first -->
    <script src="../js/auth.js"></script>
    <!-- Timer Configuration - Must load before editor.js -->
    <script src="../js/api-config.js"></script>
<script src="../js/timer-config.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Outfit:wght@100;300;400;600;700&family=JetBrains+Mono:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "stark-blue": "#00d9ff",
                        "stark-blue-dim": "rgba(0, 217, 255, 0.1)",
                        "stark-bg-dark": "#020408",
                        "stark-panel": "#0a1018",
                        "stark-border": "rgba(0, 217, 255, 0.2)",
                        "glass-bg": "rgba(10, 16, 24, 0.6)",
                        "glass-border": "rgba(255, 255, 255, 0.05)",
                        "primary": "#00d9ff",
                        "primary-dark": "#00b8d9",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "mono": ["JetBrains Mono", "Share Tech Mono", "monospace"],
                        "hud": ["Outfit", "sans-serif"],
                    },
                    boxShadow: {
                        "neon": "0 0 10px rgba(0, 217, 255, 0.3)",
                        "neon-sm": "0 0 5px rgba(0, 217, 255, 0.2)",
                        "neon-text": "0 0 8px rgba(0, 217, 255, 0.4)",
                    },
                    backgroundImage: {
                        "hex-grid": "url(\"data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 0l3.46 2L12 4 8.54 2 12 0zm0 24l-3.46-2L12 20l3.46 2L12 24zM0 12l2-3.46L4 12l-2 3.46L0 12zm24 0l-2 3.46L20 12l2-3.46L24 12z' fill='%2300d9ff' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E\")",
                    }
                },
            },
        }
    </script>
    <link rel="stylesheet" href="../css/editor.css">
    <style>
        body {
            background-color: #020408;
            color: #cbd5e1;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            background: rgba(0,0,0,0.2);
        }
        ::-webkit-scrollbar-track {
            background: rgba(10, 16, 24, 0.4); 
            backdrop-filter: blur(4px);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 217, 255, 0.15); 
            border: 1px solid rgba(0, 217, 255, 0.1);
            border-radius: 4px;
            backdrop-filter: blur(4px);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 217, 255, 0.3); 
        }
        .text-glow {
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }
        .glass-panel {
            background: rgba(10, 16, 24, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 217, 255, 0.1);
        }
        .line-numbers-glass {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            border-right: 1px solid rgba(0, 217, 255, 0.1);
        }
        #line-numbers {
            font-variant-numeric: tabular-nums;
        }
        #line-numbers > div {
            height: 1.75rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            line-height: 1.75rem;
        }
        #code-input {
            line-height: 1.75rem;
            font-size: 0.875rem;
        }
        .hud-line {
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(0, 217, 255, 0.5) 50%, transparent 100%);
        }
        .bullet-point {
            position: relative;
            padding-left: 1.5rem;
        }
        .bullet-point::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.6em;
            width: 6px;
            height: 6px;
            background-color: #00d9ff;
            box-shadow: 0 0 8px #00d9ff;
            transform: rotate(45deg);
        }
        .scanlines {
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.1) 50%,
                rgba(0,0,0,0.1)
            );
            background-size: 100% 4px;
            pointer-events: none;
        }
        #terminal-container {
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                        opacity 0.3s ease-in-out,
                        border-width 0.3s ease-in-out;
            border-width: 0;
        }
        #terminal-container[style*="height: 300px"] {
            border-width: 1px;
        }
        #terminal-toggle-btn .material-icons-round {
            transition: transform 0.3s ease-in-out;
        }
        #terminal-toggle-btn[data-open] .material-icons-round {
            transform: rotate(180deg);
        }
        @media (max-width: 1024px) {
            .split-view-left {
                width: 100% !important;
                max-width: 100% !important;
                border-right: none !important;
                border-bottom: 1px solid rgba(0, 217, 255, 0.2);
            }
            .split-view-main {
                width: 100% !important;
            }
        }
        @media (max-width: 768px) {
            header .hidden-md {
                display: none !important;
            }
            .code-toolbar-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body class="font-display h-screen overflow-hidden flex flex-col antialiased selection:bg-stark-blue/20 selection:text-stark-blue">
    <!-- Header -->
    <header class="h-12 border-b border-stark-border bg-stark-bg-dark/95 backdrop-blur-md flex items-center justify-between px-4 md:px-6 z-40 relative">
        <div class="flex items-center gap-4 md:gap-6">
            <a href="stageone.html" class="flex items-center gap-2 text-stark-blue/70 hover:text-stark-blue transition-colors group">
                <span class="material-icons-round text-sm group-hover:-translate-x-1 transition-transform">arrow_back</span>
                <span class="text-[10px] font-mono hidden sm:inline">BACK</span>
            </a>
            <div class="h-4 w-px bg-stark-border hidden md:block"></div>
            <div class="flex items-center gap-2 text-stark-blue">
                <span class="material-icons-round text-lg animate-spin-slow" style="animation-duration: 10s;">memory</span>
                <h1 class="text-xs md:text-sm font-bold tracking-[0.25em] text-white uppercase">
                    J.A.R.V.I.S. <span class="text-stark-blue text-glow">MK-85</span>
                </h1>
            </div>
            <div class="h-4 w-px bg-stark-border hidden md:block"></div>
            <div class="hidden md:flex items-center gap-4 text-[10px] font-mono tracking-wider text-slate-400">
                <span class="flex items-center gap-1.5"><span class="w-1.5 h-1.5 bg-green-500 rounded-full shadow-[0_0_5px_rgba(34,197,94,0.6)]"></span>SYS_ONLINE</span>
                <span class="flex items-center gap-1.5"><span class="w-1.5 h-1.5 bg-stark-blue rounded-full shadow-neon-sm animate-pulse"></span>SYNC_ACTIVE</span>
            </div>
        </div>
        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none hidden lg:block">
            <div class="flex items-center gap-1">
                <div class="w-16 h-[1px] bg-gradient-to-r from-transparent to-stark-blue/50"></div>
                <div class="px-2 py-0.5 border border-stark-blue/30 bg-stark-blue/5 text-[9px] text-stark-blue tracking-[0.2em]">PROTOCOL_VIEW</div>
                <div class="w-16 h-[1px] bg-gradient-to-l from-transparent to-stark-blue/50"></div>
            </div>
        </div>
        <div class="flex items-center gap-3 md:gap-4">
            <div class="hidden lg:flex items-center gap-3 text-[10px] font-mono text-stark-blue/80">
                <div class="flex flex-col items-end leading-none gap-1">
                    <span>CORE_TEMP</span>
                    <span class="text-white">32°C</span>
                </div>
                <div class="w-px h-6 bg-stark-border"></div>
                <div class="flex flex-col items-end leading-none gap-1">
                    <span>MEMORY</span>
                    <span class="text-white">2.1GB</span>
                </div>
            </div>
            <!-- Timer -->
            <div class="flex items-center gap-2 px-3 py-1.5 border border-stark-border rounded bg-stark-blue/5">
                <span class="material-icons-round text-stark-blue text-sm">timer</span>
                <div class="flex flex-col items-end leading-none gap-0.5">
                    <span class="text-[9px] text-stark-blue/70 uppercase tracking-wider">TIME</span>
                    <span id="timer-display" class="text-sm font-bold text-stark-blue tabular-nums">05:00</span>
                </div>
            </div>
            <div id="editor-team-badge" class="relative flex items-center gap-2 px-3 py-1.5 rounded border border-stark-border bg-stark-blue/5 min-w-0 max-w-[180px]">
                <span class="material-icons-round text-stark-blue text-sm flex-shrink-0">group</span>
                <span id="display-team-name" class="text-[10px] font-mono text-stark-blue truncate">—</span>
            </div>
        </div>
    </header>

    <!-- Main Content - Split View -->
    <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative bg-hex-grid">
        <!-- Left Panel - Problem Description -->
        <section class="split-view-left w-full md:w-[35%] md:min-w-[320px] md:max-w-[600px] flex flex-col border-r border-stark-border bg-stark-panel/90 backdrop-blur-sm relative z-20">
            <div class="h-10 border-b border-stark-border flex items-center justify-between px-4 md:px-5 bg-stark-blue/5 flex-shrink-0">
                <span class="text-[11px] font-bold uppercase tracking-[0.15em] text-stark-blue flex items-center gap-2">
                    <span class="material-icons-round text-sm">description</span>
                    <span class="hidden sm:inline">Protocol Specifications</span>
                    <span class="sm:hidden">Specs</span>
                </span>
                <div class="flex gap-1">
                    <span class="w-1 h-1 bg-stark-blue/40 rounded-full"></span>
                    <span class="w-1 h-1 bg-stark-blue/40 rounded-full"></span>
                    <span class="w-1 h-1 bg-stark-blue rounded-full shadow-neon-sm"></span>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-4 md:p-6">
                <div class="mb-6 md:mb-8" id="problem-container">
                    <h2 id="problem-title" class="text-xl md:text-2xl font-light text-white mb-2 tracking-wide font-display">Loading...</h2>
                    <div class="flex items-center gap-3 text-[10px] font-mono text-slate-400 mb-4 md:mb-6 flex-wrap">
                        <span id="problem-id-badge" class="px-2 py-1 border border-stark-border rounded bg-stark-blue/5 text-stark-blue">TASK_ID: --</span>
                        <span id="problem-score-badge" class="px-2 py-1 border border-red-500/30 rounded bg-red-500/5 text-red-400">SCORE: --</span>
                    </div>
                    <div class="prose prose-invert prose-sm max-w-none font-sans text-slate-300 leading-relaxed">
                        <p id="problem-description" class="mb-4 text-sm opacity-90">
                            Loading problem description...
                        </p>
                        <div id="test-cases-container" class="bg-black/40 border border-stark-border rounded-sm p-3 md:p-4 relative group overflow-hidden mt-4 md:mt-6">
                            <div class="absolute top-0 left-0 w-1 h-full bg-stark-blue/50"></div>
                            <h3 class="text-xs font-bold text-stark-blue uppercase tracking-widest border-b border-stark-border pb-2 mb-3">Test Cases</h3>
                            <div id="test-cases-list" class="space-y-3 mt-3">
                                <!-- Test cases will be dynamically inserted here -->
                            </div>
                        </div>
                        <div class="mt-4 md:mt-6 flex gap-3">
                            <div class="flex-1 bg-stark-blue/5 border border-stark-border p-3 rounded-sm">
                                <div class="text-[10px] text-stark-blue uppercase mb-1">Energy Efficiency</div>
                                <div class="text-lg font-bold text-white">94.2%</div>
                                <div class="w-full bg-slate-800 h-1 mt-2 rounded-full overflow-hidden">
                                    <div class="bg-gradient-to-r from-stark-blue to-purple-500 h-full w-[94%]"></div>
                                </div>
                            </div>
                            <div class="flex-1 bg-stark-blue/5 border border-stark-border p-3 rounded-sm">
                                <div class="text-[10px] text-stark-blue uppercase mb-1">Variance</div>
                                <div class="text-lg font-bold text-white">0.004</div>
                                <div class="w-full bg-slate-800 h-1 mt-2 rounded-full overflow-hidden">
                                    <div class="bg-green-500 h-full w-[12%]"></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 mt-4 md:mt-6 p-3 border border-yellow-500/20 bg-yellow-500/5 rounded">
                            <span class="material-icons-round text-yellow-500 text-sm mt-0.5">warning</span>
                            <p class="text-xs text-yellow-500/80 m-0">
                                Caution: System shutdown below 40%. Optimize for memory efficiency.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-3 md:p-4 border-t border-stark-border bg-stark-panel/95 backdrop-blur flex justify-between items-center flex-shrink-0">
                <button onclick="window.location.href='stageone.html'" class="text-[10px] font-mono text-stark-blue/70 hover:text-stark-blue flex items-center gap-2 transition-colors cursor-pointer">
                    <span class="material-icons-round text-[14px]">arrow_back</span>
                    <span class="hidden sm:inline">BACK TO STAGE 1</span>
                </button>
                <button id="next-stage-btn" onclick="window.location.href='leaderboard.html?from=1'" class="px-3 md:px-4 py-1.5 bg-stark-blue/10 hover:bg-stark-blue/20 border border-stark-blue/30 text-stark-blue text-[10px] font-bold tracking-widest uppercase transition-all shadow-neon-sm hover:shadow-neon cursor-pointer">
                    <span class="hidden sm:inline">PROCEED TO STAGE 2</span>
                    <span class="sm:hidden">STAGE 2</span>
                    <span class="material-icons-round text-[12px] ml-1">arrow_forward</span>
                </button>
            </div>
        </section>

        <!-- Right Panel - Code Editor -->
        <main class="split-view-main flex-1 flex flex-col min-w-0 bg-[#05090e] z-10 relative">
            <div class="absolute inset-0 bg-hex-grid opacity-20 pointer-events-none"></div>
            <div class="absolute top-0 right-0 w-32 h-32 bg-stark-blue/5 blur-3xl rounded-full pointer-events-none"></div>
            <div class="h-10 border-b border-stark-border/50 bg-glass-bg backdrop-blur flex items-center justify-between px-3 md:px-4 sticky top-0 z-30 flex-shrink-0">
                <div class="flex items-center gap-3 md:gap-4 min-w-0">
                    <div class="flex items-center gap-2 px-2 py-1 bg-stark-blue/5 rounded border border-stark-border/30 flex-shrink-0">
                        <span class="material-icons-round text-[14px] text-yellow-500">code</span>
                        <span class="text-xs font-mono text-slate-200 whitespace-nowrap">solution.js</span>
                        <span class="text-[10px] text-slate-500 italic ml-1 select-none hidden sm:inline"> - edited</span>
                    </div>
                    <div class="flex gap-1 flex-shrink-0">
                        <span class="w-2 h-2 rounded-full border border-slate-600"></span>
                        <span class="w-2 h-2 rounded-full border border-slate-600 bg-slate-600"></span>
                    </div>
                </div>
                <div class="flex items-center gap-2 md:gap-3 code-toolbar-actions">
                    <div class="flex items-center gap-2 px-2 py-1 bg-stark-blue/5 rounded border border-stark-border/30 flex-shrink-0">
                        <span class="material-icons-round text-stark-blue text-sm">settings</span>
                        <select id="lang-select" class="bg-transparent border-none text-xs font-mono text-slate-200 outline-none cursor-pointer">
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="js" selected>JavaScript</option>
                            <option value="cpp">C++</option>
                        </select>
                    </div>
                  
                    <button class="p-1.5 rounded hover:bg-white/5 text-slate-400 hover:text-white transition-colors flex-shrink-0" id="run-btn">
                        <span class="material-icons-round text-[16px]">play_circle</span>
                    </button>
                    <div class="h-4 w-px bg-stark-border mx-1 hidden sm:block"></div>
                    <button class="flex items-center gap-2 px-3 py-1 rounded bg-stark-blue hover:bg-cyan-400 text-black transition-all text-[10px] font-bold tracking-wider shadow-neon flex-shrink-0" id="submit-btn">
                        <span class="material-icons-round text-[12px]">send</span>
                        <span class="hidden sm:inline">SUBMIT</span>
                    </button>
                    <button id="terminal-toggle-btn" class="flex items-center gap-1 px-2 md:px-3 py-1 rounded border border-stark-border/30 bg-stark-blue/5 hover:bg-stark-blue/10 text-stark-blue transition-all text-[10px] font-bold tracking-wider shadow-neon-sm flex-shrink-0 group">
                        <span class="material-icons-round text-[14px] transition-transform duration-300">keyboard_arrow_up</span>
                        <span class="hidden md:inline">TERMINAL</span>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-auto relative font-mono text-sm leading-7 group flex min-h-0">
                <div class="w-12 md:w-14 line-numbers-glass flex flex-col items-end pr-2 md:pr-3 pt-4 pb-4 text-slate-600 select-none text-xs font-mono shrink-0 z-20" id="line-numbers">
                    <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div>
                </div>
                <div class="flex-1 pt-4 pb-4 px-3 md:px-4 relative z-10 min-w-0">
                    <textarea id="code-input" class="w-full h-full bg-transparent text-slate-300 font-mono text-sm resize-none outline-none border-none" spellcheck="false" placeholder="// Enter your solution...">// STARK INDUSTRIES - OPTIMIZATION PROTOCOL
// MK. 85 CORE REVISION

const LIMIT = 100;

function stabilizeFlow(readings) {
  // Process raw telemetry
  let cleanData = readings.filter(r => r <= LIMIT);
  return cleanData;
}</textarea>
                </div>
            </div>
            <!-- Terminal Section -->
            <div id="terminal-container" class="border-t border-stark-border bg-black/80 backdrop-blur relative flex flex-col transition-all duration-300 ease-in-out overflow-hidden flex-shrink-0" style="height: 0; opacity: 0;">
                <div class="absolute top-0 left-0 right-0 h-1 cursor-ns-resize hover:bg-stark-blue/50 transition-colors z-20"></div>
                <div class="h-8 bg-white/5 flex items-center justify-between px-3 md:px-4 border-b border-white/5 flex-shrink-0">
                    <div class="flex items-center gap-3 md:gap-4">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-stark-blue border-b border-stark-blue h-full flex items-center px-1">Terminal</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-slate-500 hover:text-slate-300 cursor-pointer hidden sm:inline">Problems</span>
                        <span class="text-[10px] font-bold uppercase tracking-widest text-slate-500 hover:text-slate-300 cursor-pointer hidden sm:inline">Debug Console</span>
                    </div>
                    <div class="flex gap-2">
                        <button id="terminal-close-btn" class="material-icons-round text-[14px] text-slate-500 cursor-pointer hover:text-white transition-colors">close</button>
                    </div>
                </div>
                <div class="flex-1 p-3 font-mono text-xs overflow-auto bg-transparent relative min-h-[200px]" id="terminal-output">
                    <div class="absolute inset-0 scanlines opacity-20 pointer-events-none"></div>
                    <div class="space-y-1 relative z-10">
                        <div class="text-slate-400">
                            <span class="text-green-500">➜</span> <span class="text-blue-400">~/protocols/mk85</span> <span class="text-slate-300">[SEC_PROTOCOL] Initializing...</span>
                        </div>
                        <div class="text-slate-500 pt-1">[SYSTEM] Environment: Node.js 18.14.0 - OK</div>
                        <div class="flex items-center gap-2 text-blue-300">
                            <span class="text-blue-500">ℹ</span> [SUCCESS] Modules loaded in 45ms
                        </div>
                        <div class="text-slate-400">
                            <span class="text-green-500">➜</span> <span class="text-blue-400">~</span> <span class="text-slate-300">Running optimization_test_v1.0.2...</span>
                        </div>
                        <div class="flex items-center gap-2 text-green-400">
                            <span class="text-green-500">[OK]</span> Test 01: Core Voltage Filter: [PASSED]
                        </div>
                        <div class="flex items-start gap-2 text-red-400 pt-1">
                            <span class="text-red-500">[FAIL]</span>
                            <div>
                                Test 02: Variance Accuracy: [FAILED - 4% Deviation]<br/>
                                <span class="opacity-70 text-[10px] ml-1">at RepulsorController.calibrate (line 14:15)</span>
                            </div>
                        </div>
                        <div class="pt-2 text-slate-400">
                            <span class="text-green-500">➜</span> <span class="text-blue-400">~/protocols/mk85</span> <span class="w-2 h-4 bg-stark-blue/50 inline-block align-middle animate-pulse"></span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="h-6 bg-stark-bg-dark border-t border-stark-border flex items-center justify-between px-3 md:px-4 text-[10px] font-mono text-slate-500 z-50 relative flex-shrink-0">
        <div class="flex items-center gap-3 md:gap-4 min-w-0">
            <span class="flex items-center gap-1.5 text-stark-blue flex-shrink-0">
                <span class="material-icons-round text-[10px]">cloud_queue</span>
                <span class="hidden sm:inline">STARK_CLOUD</span>
            </span>
            <span class="flex items-center gap-1 hover:text-slate-300 cursor-pointer transition-colors flex-shrink-0">
                <span class="material-icons-round text-[10px]">code_off</span>
                <span class="hidden sm:inline">master*</span>
            </span>
            <span class="hidden md:inline hover:text-slate-300 cursor-pointer transition-colors truncate">
                RepulsorController &gt; calibrate
            </span>
        </div>
        <div class="flex items-center gap-3 md:gap-4 flex-shrink-0">
            <span class="flex items-center gap-1.5 hover:text-stark-blue cursor-pointer transition-colors">
                Ln <span id="line-count">14</span>, Col <span id="col-count">32</span>
            </span>
            <span class="text-slate-600 hidden sm:inline">UTF-8</span>
            <span class="flex items-center gap-1 text-stark-blue hover:text-white cursor-pointer transition-colors">
                <span class="material-icons-round text-[10px]">notifications</span>
            </span>
        </div>
    </footer>

    <script src="../js/editor.js"></script>
    <script>
        tailwind.config.theme.extend.animation = {
            ...tailwind.config.theme.extend.animation,
            'spin-slow': 'spin 3s linear infinite',
        }
    </script>
</body>
</html>
